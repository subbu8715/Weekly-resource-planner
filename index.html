<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resource Availability Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .status-cell { min-width: 120px; height: 80px; transition: transform .2s; }
    .status-cell:hover { transform: scale(1.03); }
    .status-wfo { background-color:#166534; color:#fff; }
    .status-wfh { background-color:#86efac; color:#14532d; }
    .status-planned-leave { background-color:#f97316; color:#fff; }
    .status-unplanned-leave { background-color:#b91c1c; color:#fff; }
    .status-default { background-color:#f3f4f6; }
    .modal-backdrop { background: rgba(0,0,0,.5); }
    .table-container::-webkit-scrollbar { display: none; }
    .table-container { -ms-overflow-style:none; scrollbar-width:none; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <header class="text-center mb-6">
      <h1 class="text-4xl font-bold text-gray-900">Resource Availability Tracker</h1>
      <p id="week-range" class="text-xl text-gray-600 mt-2"></p>
    </header>

    <!-- Top Controls -->
    <div class="flex flex-wrap items-center justify-center gap-3 mb-6">
      <button id="prev-week" class="bg-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-gray-200">- Week</button>
      <button id="today" class="bg-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-gray-200">Today</button>
      <button id="next-week" class="bg-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-gray-200">+ Week</button>
      <!-- NEW Team Bulk Update Button -->
      <button id="team-bulk-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-blue-700">Team Bulk Update (Mon–Fri)</button>
    </div>

    <!-- Grid -->
    <div class="bg-white rounded-xl shadow-lg p-4 overflow-hidden">
      <div id="grid-wrap" class="table-container overflow-x-auto">
        <table class="w-full border-collapse">
          <thead id="thead"></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div id="empty" class="hidden text-center py-16">
        <h3 class="text-xl font-semibold text-gray-700">Your planner is empty</h3>
        <p class="text-gray-500 mt-2">Add people to the <b>Members</b> tab in the Google Sheet.</p>
      </div>
    </div>

    <!-- Legend -->
    <div class="mt-6">
      <h2 class="text-lg font-semibold mb-2">Legend</h2>
      <div class="flex flex-wrap gap-3">
        <span class="px-3 py-2 rounded-lg status-wfo font-semibold">WFO</span>
        <span class="px-3 py-2 rounded-lg status-wfh font-semibold">WFH</span>
        <span class="px-3 py-2 rounded-lg status-planned-leave font-semibold">Planned Leave</span>
        <span class="px-3 py-2 rounded-lg status-unplanned-leave font-semibold">Unplanned Leave</span>
        <span class="px-3 py-2 rounded-lg status-default font-semibold">No Data</span>
      </div>
    </div>
  </div>

  <!-- Status Modal -->
  ... <!-- (unchanged from your version) -->

  <!-- Bulk Modal (Per Member) -->
  ... <!-- (unchanged from your version) -->

  <!-- NEW Team Bulk Modal -->
  <div id="team-bulk-modal" class="modal-backdrop fixed inset-0 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm">
      <h2 class="text-2xl font-bold mb-1">Team Bulk Update (Mon–Fri)</h2>
      <p class="text-gray-600 mb-4">This will set the same status for <b>all team members</b> for Mon–Fri of this week.</p>
      <div class="grid grid-cols-1 gap-2 mb-2">
        <button class="team-bulk-choice status-wfo py-2 rounded font-bold" data-status="wfo">Work from Office</button>
        <button class="team-bulk-choice status-wfh py-2 rounded font-bold" data-status="wfh">Work from Home</button>
        <button class="team-bulk-choice status-planned-leave py-2 rounded font-bold" data-status="planned-leave">Planned Leave</button>
        <button class="team-bulk-choice status-unplanned-leave py-2 rounded font-bold" data-status="unplanned-leave">Unplanned Leave</button>
      </div>
      <div class="text-right">
        <button id="close-team-bulk" class="bg-gray-200 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300">Close</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-sm px-4 py-2 rounded-lg shadow-lg hidden"></div>

  <script>
    // === Replace this with YOUR Apps Script Web App URL (the one ending with /exec)
    const API_BASE = "https://script.google.com/macros/s/AKfycbyKziIiPKCEG8bjnEvYw2oFh0FehfLUCJcB6JKCqIypA-KwNsKCb2qnfAF7hbPKjjah/exec";

    // (your existing JS code stays the same, except add below at the end)

    // === Team Bulk Update Events ===
    const teamBulkBtn = document.getElementById('team-bulk-btn');
    const teamBulkModal = document.getElementById('team-bulk-modal');
    const closeTeamBulk = document.getElementById('close-team-bulk');

    teamBulkBtn.onclick = ()=> {
      teamBulkModal.classList.remove('hidden'); teamBulkModal.classList.add('flex');
    };
    closeTeamBulk.onclick = ()=> {
      teamBulkModal.classList.add('hidden'); teamBulkModal.classList.remove('flex');
    };

    document.querySelectorAll('.team-bulk-choice').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        const st = btn.dataset.status;
        const week = getWeek(currentDate);
        for (const m of members){
          for (const d of week){
            const dow = d.getDay();
            if (dow >= 1 && dow <= 5){ // Mon–Fri
              const ds = toISO(d);
              statuses[`${m.name}_${ds}`] = { status: st, comment: '' };
              await apiSetStatus(m.name, ds, st, '');
            }
          }
        }
        render();
        showToast('Team bulk update applied','success');
        teamBulkModal.classList.add('hidden'); teamBulkModal.classList.remove('flex');
      });
    });
  </script>
</body>
</html>
