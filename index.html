<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resource Availability Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; }
    .status-cell { min-width: 120px; height: 80px; transition: transform .2s; }
    .status-cell:hover { transform: scale(1.05); z-index: 10; }
    .status-wfo { background-color:#166534; color:#fff; }
    .status-wfh { background-color:#86efac; color:#14532d; }
    .status-planned-leave { background-color:#f97316; color:#fff; }
    .status-unplanned-leave { background-color:#b91c1c; color:#fff; }
    .status-default { background-color:#f3f4f6; }
    .modal-backdrop { background-color: rgba(0,0,0,.5); transition: opacity .3s ease-in-out; }
    .table-container::-webkit-scrollbar { display: none; }
    .table-container { -ms-overflow-style:none; scrollbar-width:none; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <header class="text-center mb-6">
      <h1 class="text-4xl font-bold text-gray-900">Resource Availability Tracker</h1>
      <p id="week-range-display" class="text-xl text-gray-600 mt-2"></p>
    </header>

    <!-- Controls -->
    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
      <div class="flex items-center gap-2">
        <button id="prev-week-btn" class="bg-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-gray-200 transition">- Week</button>
        <button id="today-btn" class="bg-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-gray-200 transition">Today</button>
        <button id="next-week-btn" class="bg-white px-4 py-2 rounded-lg shadow font-semibold hover:bg-gray-200 transition">+ Week</button>
      </div>
      <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
        <div class="flex gap-2">
          <button id="bulk-upload-btn" class="bg-green-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-700 transition shadow-md w-full sm:w-auto">Bulk Upload</button>
          <button id="add-member-btn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition shadow-md w-full sm:w-auto">Add Team Member</button>
        </div>
        <div class="flex gap-2">
          <button id="export-csv-btn" class="bg-gray-900 text-white font-semibold py-2 px-6 rounded-lg hover:bg-black transition shadow-md w-full sm:w-auto">Export CSV</button>
          <a id="download-template" class="bg-white border px-4 py-2 rounded-lg shadow font-semibold hover:bg-gray-50 transition w-full sm:w-auto text-center" download="bulk_template.csv">Template</a>
        </div>
      </div>
    </div>

    <!-- Planner Grid -->
    <div class="bg-white rounded-xl shadow-lg p-4 overflow-hidden">
      <div id="planner-grid-container" class="table-container overflow-x-auto">
        <table class="w-full border-collapse">
          <thead id="planner-head"></thead>
          <tbody id="planner-body"></tbody>
        </table>
      </div>
      <div id="empty-state" class="hidden text-center py-16">
        <h3 class="text-xl font-semibold text-gray-700">Your planner is empty</h3>
        <p class="text-gray-500 mt-2">Click "Add Team Member" or use <b>Bulk Upload</b> to get started.</p>
      </div>
    </div>

    <!-- Toast / Info -->
    <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-sm px-4 py-2 rounded-lg shadow-lg hidden"></div>
  </div>

  <script>
    // âœ… Backend URL (Apps Script Web App)
    const API_BASE = "https://script.google.com/macros/s/AKfycbyKziIiPKCEG8bjnEvYw2oFh0FehfLUCJcB6JKCqIypA-KwNsKCb2qnfAF7hbPKjjah/exec";

    // Example: Fetch data
    async function loadData() {
      try {
        const res = await fetch(`${API_BASE}?action=getData`);
        const data = await res.json();
        console.log("Loaded data from backend:", data);

        // Render members
        const plannerBody = document.getElementById("planner-body");
        plannerBody.innerHTML = "";
        data.members.forEach(m => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="border px-4 py-2">
              <div class="font-bold">${m.name}</div>
              <div class="text-sm text-gray-500">${m.role}</div>
              <div class="text-xs text-gray-400">Shift: ${m.shift}</div>
              <div class="text-xs text-gray-400">Region: ${m.region}</div>
            </td>`;
          plannerBody.appendChild(tr);
        });

        // TODO: statuses can be rendered here
      } catch (err) {
        console.error("Error fetching data:", err);
      }
    }

    document.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
